<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.yuyue.app.api.mapper.UploadFileMapper" >
    <resultMap type="com.yuyue.app.api.domain.UploadFile" id="myUploadFile">
        <id column="id" property="id"/>
        <result column="authorId" property="authorId"/>
        <result column="UPLOAD_TIME" property="uploadTime"/>
        <result column="filesName" property="filesName"/>
        <result column="filesPath" property="filesPath"/>
        <result column="filesType" property="filesType"/>
        <result column="filesMD5" property="filesMD5"/>
        <result column="fileSize" property="fileSize"/>
        <result column="description" property="description"/>
        <result column="playAmount" property="playAmount"/>
        <result column="commentAmount" property="commentAmount"/>
        <result column="likeAmount" property="likeAmount"/>
        <result column="attentionAmount" property="attentionAmount"/>
        <result column="duration" property="duration"/>
        <result column="title" property="title"/>
        <result column="videoAddress" property="videoAddress"/>
        <result column="categoryId" property="categoryId"/>
        <result column="status" property="status"/>
        <association property="appUser" javaType="com.yuyue.app.api.domain.AppUser">
            <!-- 关联条件Employee的dept_id对应着Department的id -->
            <id column="ID" property="id"/>
            <result column="USER_NICK_NAME" property="nickName"/>
            <result column="HEADP_URL" property="headpUrl"/>
            <result column="ATTENTION_TOTAL" property="attentionTotal"/>
            <result column="LIKE_TOTAL" property="likeTotal"/>
            <result column="COMMENT_TOTAL" property="commentTotal"/>
        </association>
    </resultMap>

    <select id="getVideo" resultMap="myUploadFile" parameterType="String">
        select
        b.id,DATE_FORMAT(b.UPLOAD_TIME,'%Y-%m-%d %H:%i:%s') UPLOAD_TIME,b.filesName,b.filesPath,
        b.filesType,b.fileSize,b.authorId,b.description,b.playAmount,b.commentAmount,b.likeAmount,b.attentionAmount,
        b.duration,b.title,b.videoAddress,b.categoryId,b.status,
        m.ID,m.USER_NICK_NAME,m.HEADP_URL,m.ATTENTION_TOTAL,m.LIKE_TOTAL,m.COMMENT_TOTAL
        from ${tableName} b
        left join yuyue_merchant m on b.authorId = m.ID
        WHERE  1=1 and b.filesType = 'video' and b.status ='10B'
            <choose>
                <when test="categoryId!=null and categoryId!=''">  and b.categoryId=#{categoryId}  </when>
            </choose>
            <choose>
                <when test="content!=null and content!=''">  and CONCAT(b.title,m.USER_NICK_NAME) LIKE "%"#{content}"%"  </when>
            </choose>
        ORDER BY b.UPLOAD_TIME DESC
         LIMIT #{begin},#{size}

    </select>


    <select id="getVideoToHomePage" resultMap="myUploadFile" parameterType="Integer">
        select
        b.id,DATE_FORMAT(b.UPLOAD_TIME,'%Y-%m-%d %H:%i:%s') UPLOAD_TIME,b.filesName,b.filesPath,
        b.filesType,b.fileSize,b.authorId,b.description,b.playAmount,b.commentAmount,b.likeAmount,b.attentionAmount,
        b.duration,b.title,b.videoAddress,b.categoryId,b.status,
        m.ID,m.USER_NICK_NAME,m.HEADP_URL,m.ATTENTION_TOTAL,m.LIKE_TOTAL,m.COMMENT_TOTAL
        from yuyue_upload_file_home b
        left join yuyue_merchant m on b.authorId = m.ID
        WHERE  1=1 and b.filesType = 'video' and b.status ='10B'
        ORDER BY playAmount DESC
        LIMIT #{begin},#{size}

    </select>


</mapper>